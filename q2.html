<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" src="./js/main.js"></script>
    <title>Panolens</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="tour">
        <div class="container">
            <div class="tour__head">
                <h2>Question 2</h2>
            </div>

            <div class="image-container" 
            data-images="test0.png,test1.png,test2.png,test3.png,test4.png" 
            data-path="images/test/"></div>
                   
            <!-- Survey Text Boxes -->
            <div class="survey-inputs">
                <label for="question1">What do you think about this view?</label>
                <textarea id="question1" rows="3" placeholder="Type your answer here..."></textarea>

                <label for="question2">Any suggestions for improvement?</label>
                <textarea id="question2" rows="3" placeholder="Type your answer here..."></textarea>
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button id="prev-btn" onclick="location.href='q1.html'">Previous</button>
                <button id="next-btn" onclick="location.href='q3.html'">Next</button>
            </div>
        </div>
    </div>

    <input type="email" id="userEmail" placeholder="Enter your email" required readonly>

    <script>
        // Prefill saved answers if available in localStorage
        window.onload = function() {
            const savedEmail = localStorage.getItem('userEmail');

            const savedQ1Answers = JSON.parse(localStorage.getItem('q1_answers'));
            if (savedQ1Answers) {
                // Prefill the answers in the text areas if available in localStorage
                document.getElementById('question1').value = savedQ1Answers.q1 || '';
                document.getElementById('question2').value = savedQ1Answers.q2 || '';
            }
        };

        // Save answers to localStorage when the user clicks "Save Answers"
        document.getElementById('next-btn').addEventListener('click', () => {
            const question1 = document.getElementById('question1').value;
            const question2 = document.getElementById('question2').value;

            // Get the email from localStorage
            const email = localStorage.getItem('userEmail');

            if (!email || !validateEmail(email)) {
                alert('Please enter a valid email.');
                return;
            }

            // Store this page's answers in localStorage
            localStorage.setItem('q1_answers', JSON.stringify({
                email,
                q1: question1,
                q2: question2,
                timestamp: new Date().toISOString(),
                page: 'q1',
            }));

            // Proceed to the next page
            location.href = 'final.html';
        });

        // Simple email validation function
        function validateEmail(email) {
            const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return re.test(String(email).toLowerCase());
        }

        const savedEmail = localStorage.getItem('userEmail');
        if (savedEmail) {
            document.getElementById('userEmail').value = savedEmail;
        } else {
            alert('Please enter your email on the first page');
            location.href = 'index.html';  // Redirect to the first page if email is missing
        }
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/105/three.min.js"></script>
    <script src="./js/panolens.min.js"></script>
    <script src="./js/main.js"></script>
</body>
</html>
